# TravelPlanner

https://t.me/plan_trip_bot

В этом файле находится техническая документация. Инструкцию по пользованию см. в user-guide.md.

## Запуск
Склонируйте репозитроий и выполните `docker compose up`. Бот запустится.

## Описание модулей
Бот состоит из трёх модулей — клиентской части, а также приложения с бэкендом и фронтендом, отвечающего за показ маршрута. Модули находятся в соответствующих папках.

Кроме этого, в качестве дополнительных сервисов используются ngrok и postgresql (см. следующий раздел). 

## Интеграции

### Получение публичного интернет-адреса

Для корректной работы telegram web app необходим адрес, который достижим в интернете. Для этих целей используется ngrok, который присваивает одному из портов сервера публичный URL. Так как ngrok не является web-сервером и не может отгружать статические файлы и проксировать трафик внутри машины, в качестве сервиса дополнительно установлен nginx, который обслуживает backend и frontend.

### Работа с API
В качестве API для получения списка городов используется [Nominatim](https://nominatim.openstreetmap.org), как один из немногих бесплатных открытых сервисов, берущих данные из OSM и поддерживающих запросы как текстом, так и по координатам.
В качестве СУБД используется PostgreSQL.

### Рисование карты маршрута
Для построения маршрута используется сервис [Openrouteservice](https://openrouteservice.org). Так же как и Nominatim, он основан на OSM и бесплатен. Openrouteservice отдает данные в формате GeoJson, которые надо отобразить на карте.

Для отображения данных на карте используется инструмент https://github.com/loskoderos/georender. Так как он написан на node.js, в докер-контейнер с ботом дополнительно устанавливается node и прочие зависимости. К сожалению, похожего инструмента (быстрого и легковесного) на Python автору найти не удалось.

Так как georenger не опубликован на npm, он подключен к боту с помощью функции git submodules.
